{% load static %}
<!doctype html>
<html lang="es">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mis agendas – MiHora Lampa</title>
  <link rel="icon" type="image/png" href="{% static 'core/img/logo_lampa.png' %}">
  <style>
    :root {
      --cosam-primary: #1769aa;
      --cosam-accent: #2aa86b;
      --ink-900: #0f172a;
      --ink-700: #334155;
      --ink-500: #64748b;
      --ink-300: #cbd5e1;
      --bg-50: #f8fafc;
      --white: #fff;
      --danger: #d92d20;
      --focus: rgba(23, 105, 170, .25);
      --success: #16a34a;
      --warning: #f59e0b;
      --info: #0ea5e9;
      --muted: #94a3b8;
      --violet: #7c3aed;
    }

    * {
      box-sizing: border-box
    }

    html,
    body {
      height: 100%
    }

    body {
      margin: 0;
      background: var(--bg-50);
      color: var(--ink-900);
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
    }

    a {
      color: inherit;
      text-decoration: none
    }

    .container {
      max-width: 1140px;
      margin: 0 auto;
      padding: 24px
    }

    /* Hero */
    .hero {
      background: linear-gradient(135deg, var(--cosam-primary), var(--cosam-accent));
      color: var(--white);
      border-radius: 20px;
      padding: 28px 24px;
      display: grid;
      gap: 8px;
    }

    .hero .kicker {
      opacity: .9;
      font-weight: 600;
      letter-spacing: .3px;
      font-size: .95rem
    }

    .hero h1 {
      margin: 0;
      font-size: clamp(1.6rem, 2.5vw, 2.2rem);
      line-height: 1.15;
      font-weight: 800
    }

    .hero .sub {
      margin: 0;
      opacity: .95;
      font-size: 1.05rem
    }

    /* Grid */
    .grid {
      display: grid;
      gap: 20px;
      margin-top: 22px;
      grid-template-columns: repeat(12, 1fr)
    }

    .col-12 {
      grid-column: 1 / -1
    }

    /* Card */
    .card {
      background: var(--white);
      border-radius: 16px;
      box-shadow: 0 12px 30px rgba(2, 8, 23, .06), 0 2px 8px rgba(2, 8, 23, .03);
      border: 1px solid rgba(2, 8, 23, .06);
    }

    .card-h {
      padding: 18px 18px 0 18px;
      border-bottom: 1px solid rgba(2, 8, 23, .06)
    }

    .card-h h2 {
      margin: 0;
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--ink-700)
    }

    .card-b {
      padding: 18px
    }

    .card-f {
      padding: 16px 18px;
      border-top: 1px solid rgba(2, 8, 23, .06);
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap
    }

    /* Botones */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      padding: .8rem 1rem;
      border-radius: 12px;
      font-weight: 700;
      border: 2px solid transparent;
      transition: transform .05s ease, box-shadow .15s ease, filter .15s ease;
      text-align: center;
      cursor: pointer;
      background: transparent;
    }

    .btn:active {
      transform: translateY(1px)
    }

    .btn-primary {
      background: var(--cosam-primary);
      color: #fff;
      box-shadow: 0 10px 18px rgba(23, 105, 170, .25)
    }

    .btn-primary:hover {
      filter: brightness(.98)
    }

    .btn-outline {
      background: #fff;
      color: var(--cosam-primary);
      border-color: rgba(23, 105, 170, .35)
    }

    .btn-outline:hover {
      background: rgba(23, 105, 170, .06)
    }

    .btn-ghost {
      background: transparent;
      color: var(--ink-700);
      border-color: transparent
    }

    .btn-sm {
      padding: .55rem .75rem;
      border-radius: 10px;
      font-weight: 700;
      font-size: .9rem
    }

    .w-100 {
      width: 100%
    }

    /* Formulario (filtros) */
    .form-grid {
      display: grid;
      gap: 12px;
      grid-template-columns: repeat(12, 1fr)
    }

    .span-3 {
      grid-column: span 3
    }

    .span-4 {
      grid-column: span 4
    }

    .span-12 {
      grid-column: 1 / -1
    }

    @media (max-width: 992px) {

      .span-3,
      .span-4 {
        grid-column: 1 / -1
      }
    }

    .field {
      display: flex;
      flex-direction: column;
      gap: 6px
    }

    .label {
      font-weight: 700;
      color: var(--ink-700);
      font-size: .95rem
    }

    .actions {
      display: flex;
      gap: 10px;
      justify-content: flex-end;
      align-items: center
    }

    .card-b input[type="date"] {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid var(--ink-300);
      border-radius: 10px;
      background: #fff;
      color: var(--ink-900);
      outline: none;
      font-size: 1rem;
      transition: box-shadow .15s ease, border-color .15s ease;
      appearance: none;
    }

    .card-b input:focus {
      border-color: var(--cosam-primary);
      box-shadow: 0 0 0 4px var(--focus)
    }

    /* Tabla */
    .table-wrap {
      width: 100%;
      overflow: auto;
      border-radius: 12px;
      border: 1px solid rgba(2, 8, 23, .06)
    }

    table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      min-width: 900px;
    }

    thead th {
      position: sticky;
      top: 0;
      background: #f1f5f9;
      color: var(--ink-700);
      font-weight: 700;
      font-size: .92rem;
      text-align: left;
      padding: 12px 14px;
      border-bottom: 1px solid rgba(2, 8, 23, .08);
    }

    tbody td {
      padding: 12px 14px;
      border-bottom: 1px solid rgba(2, 8, 23, .06);
      font-size: .96rem;
      color: var(--ink-900)
    }

    tbody tr:hover {
      background: #f8fafc
    }

    .text-end {
      text-align: right
    }

    .text-center {
      text-align: center
    }

    .text-nowrap {
      white-space: nowrap
    }

    .muted {
      color: var(--ink-500);
      font-size: .92rem
    }

    /* Badges estado */
    .badge {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: .35rem .6rem;
      border-radius: 999px;
      font-weight: 700;
      font-size: .85rem;
      line-height: 1;
      border: 1px solid transparent;
    }

    .badge-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px
    }

        /* Mensajes (messages) */
    .alerts {
      display: grid;
      gap: 10px;
      margin-bottom: 12px
    }

    .alert {
      padding: 10px 12px;
      border: 1px solid rgba(2, 8, 23, .12);
      background: #fff;
      border-radius: 12px;
      color: var(--ink-700);
    }

    .alert-success {
      background: #dcfce7;
      border: 1px solid #86efac;
      color: #166534;
      font-weight: 600;
    }    

    /* FONDOS / BORDES por estado */

    /* ===== ESTILOS DE ESTADOS ===== */

    /* Fondo, borde y color del texto */
    .estado--libre {
      background: #ecfdf5;
      color: #065f46;
      border-color: #bbf7d0
    }

    /* verde */
    .estado--pendiente {
      background: #fef3c7;
      color: #92400e;
      border-color: #fde68a
    }

    /* ámbar */
    .estado--confirmada {
      background: #eff6ff;
      color: #1e40af;
      border-color: #bfdbfe
    }

    /* azul */
    .estado--atendida {
      background: #dcfce7;
      color: #166534;
      border-color: #86efac
    }

    /* verde claro */
    .estado--ausente {
      background: #fff7ed;
      color: #9a3412;
      border-color: #fed7aa
    }

    /* naranja */
    .estado--cancelada {
      background: #fef2f2;
      color: #991b1b;
      border-color: #fecaca
    }

    /* rojo */
    .estado--default {
      background: #eef2f7;
      color: #334155;
      border-color: #cbd5e1
    }

    /* gris */

    /* Punto de color */
    .dot--libre {
      background: #16a34a
    }

    .dot--pendiente {
      background: #f59e0b
    }

    .dot--confirmada {
      background: #3b82f6
    }

    .dot--atendida {
      background: #22c55e
    }

    .dot--ausente {
      background: #ea580c
    }

    .dot--cancelada {
      background: #ef4444
    }

    .dot--default {
      background: #64748b
    }

    /* === Ajuste específico de la fila de filtro === */
    .filter-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 20px;
      flex-wrap: wrap;
    }

    .filter-row .left {
      display: flex;
      align-items: center;
      gap: 10px;
      flex: 1;
      min-width: 300px;
    }

    .filter-row .left input[type="date"] {
      flex: 0 1 220px;
    }

    .filter-row .right {
      margin-left: auto;
    }
  </style>
</head>

<body>
  <div class="container">
    <!-- HERO -->
    <section class="hero" aria-labelledby="hero-title">
      <span class="kicker">MiHora Lampa · Profesional</span>
      <h1 id="hero-title">Mis agendas</h1>
      <p class="sub">Revisa tus bloques del día seleccionado. Por defecto se muestra la fecha actual.</p>
    </section>

    {% if messages %}
    <div class="alerts">
      {% for m in messages %}
      <br>
      <div
        class="alert {% if 'success' in m.tags %}alert-success{% elif 'error' in m.tags %}alert-error{% endif %}">
        {{ m }}
      </div>
      {% endfor %}
    </div>
    {% endif %}

    <!-- FILTRO FECHA -->
    <section class="grid" aria-label="Filtros">
      <div class="col-12">
        <form method="get" class="card" role="search">
          <div class="card-h">
            <h2>Filtrar por fecha</h2>
          </div>
          <div class="card-b">
            {% now "Y-m-d" as hoy %}
            <div class="filter-row">
              <div class="left">
                <input id="f-fecha" type="date" name="fecha" value="{{ f_fecha|default:hoy }}">
                <button class="btn btn-primary" type="submit">Ver</button>
              </div>
              <div class="right">
                <a href="{% url 'profesional_home' %}" class="btn btn-outline">Volver</a>
              </div>
            </div>
          </div>
        </form>
      </div>
    </section>


    <!-- TABLA RESULTADOS -->
    <section class="grid" aria-label="Resultados">
      <div class="col-12">
        <div class="card">
          <div class="card-h">
            <h2>Bloques del día</h2>
          </div>
          <div class="card-b">
            <div class="table-wrap" role="region" aria-label="Tabla de mis agendas">
              <table>
                <thead>
                  <tr>
                    <th>Hora</th>
                    <th>Modalidad</th>
                    <th>Ubicación</th>
                    <th>Estado</th>
                    <th>Paciente</th>
                    <th class="text-end">Acciones</th>
                  </tr>
                </thead>
                <tbody>
                  {% for a in agendas %}
                  <tr>
                    <td class="text-nowrap">{{ a.inicio|date:"H:i" }}–{{ a.fin|date:"H:i" }}</td>
                    <td>{{ a.get_modalidad_display }}</td>
                    <td>{{ a.ubicacion.nombre }}</td>

                    {% if a.cita %}
                    {% with st=a.cita.estado.nombre|slugify %}
                    <td>
                      <span class="badge estado--{{ st|default:'default' }}">
                        <span class="badge-dot dot--{{ st|default:'default' }}"></span>
                        {{ a.cita.estado.nombre }}
                      </span>
                    </td>
                    {% endwith %}
                    <td>{{ a.cita.paciente.nombre_completo }}</td>
                    <td class="text-end">
                      <a class="btn btn-primary btn-sm" href="{% url 'pro_cita_detail' a.cita.id %}">Abrir</a>
                    </td>
                    {% else %}
                    <td>
                      <span class="badge estado--libre">
                        <span class="badge-dot dot--libre"></span>
                        Libre
                      </span>
                    </td>
                    <td>—</td>
                    <td class="text-end"><span class="muted">Sin acciones</span></td>
                    {% endif %}
                  </tr>
                  {% empty %}
                  <tr>
                    <td colspan="6" class="text-center" style="padding:24px 12px">No hay bloques para este día.</td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
          <div class="card-f">
            <span class="muted">Fecha: <strong>{{ f_fecha|default:hoy }}</strong></span>
          </div>
        </div>
      </div>
    </section>
  </div>
</body>

</html>