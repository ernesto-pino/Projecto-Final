<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Cambiar estado – MiHora Lampa</title>
    <style>
      :root {
        --cosam-primary: #1769aa;
        --cosam-accent: #2aa86b;
        --ink-900: #0f172a;
        --ink-700: #334155;
        --ink-500: #64748b;
        --ink-300: #cbd5e1;
        --bg-50: #f8fafc;
        --white: #fff;
        --danger: #b91c1c;
      }
      * { box-sizing: border-box; }
      html, body { height: 100%; }
      body {
        margin: 0;
        background: var(--bg-50);
        color: var(--ink-900);
        font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      }
      a { text-decoration: none; color: inherit; }
      .container { max-width: 1140px; margin: 0 auto; padding: 24px; }

      /* Hero (idéntico a agendas) */
      .hero {
        background: linear-gradient(135deg, var(--cosam-primary), var(--cosam-accent));
        color: #fff;
        border-radius: 20px;
        padding: 28px 24px;
        display: grid;
        gap: 8px;
      }
      .hero .kicker { opacity: .9; font-weight: 600; letter-spacing: .3px; font-size: .95rem; }
      .hero h1 { margin: 0; font-size: clamp(1.6rem, 2.5vw, 2.2rem); line-height: 1.15; font-weight: 800; }
      .hero .sub { margin: 0; opacity: .95; font-size: 1.05rem; }

      /* Card */
      .card {
        background: #fff;
        border-radius: 16px;
        box-shadow: 0 12px 30px rgba(2, 8, 23, 0.06), 0 2px 8px rgba(2, 8, 23, 0.03);
        border: 1px solid rgba(2, 8, 23, 0.06);
      }
      .card-body { padding: 18px; }
      .card-footer {
        padding: 16px 18px;
        border-top: 1px solid rgba(2, 8, 23, 0.06);
        display: flex;
        gap: 12px;
        justify-content: flex-end;
      }

      /* Campos y etiquetas */
      label { display:block; font-weight:700; color:var(--ink-700); margin-bottom:6px; }
      .mb-3 { margin-bottom: 1rem; }
      .card-body select,
      .form-select {
        width: 100%;
        padding: .6rem .75rem;
        border-radius: 12px;
        border: 1px solid var(--ink-300);
        background: #fff;
        font: inherit;
        color: var(--ink-900);
        outline: none;
        transition: box-shadow .15s ease, border-color .15s ease;
      }
      .card-body select:focus {
        border-color: rgba(23,105,170,.5);
        box-shadow: 0 0 0 4px rgba(23,105,170,.15);
      }

      /* Botones */
      .btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        padding: .9rem 1.1rem;
        border-radius: 12px;
        font-weight: 700;
        border: 2px solid transparent;
        transition: transform .05s ease, box-shadow .15s ease, filter .15s ease;
        text-align: center;
        cursor: pointer;
      }
      .btn:active { transform: translateY(1px); }
      .btn-primary {
        background: var(--cosam-primary);
        color:#fff;
        box-shadow: 0 10px 18px rgba(23,105,170,.25);
      }
      .btn-primary:hover { filter: brightness(.98); }
      .btn-outline-secondary {
        background:#fff;
        color:#334155;
        border:2px solid #cbd5e1;
      }
      .btn-outline-secondary:hover { background: rgba(23,105,170,.06); }

      /* Errores */
      .text-danger { color: #b91c1c; }
      .alert { border-radius: 12px; padding: .8rem 1rem; }
      .alert-danger {
        background: #fef2f2;
        color: #991b1b;
        border: 1px solid #fecaca;
      }

      .h5 { font-size: 1.1rem; margin-bottom: 1rem; }
    </style>
  </head>
  <body>
    {% load humanize tz %}
    <div class="container">
      <!-- HERO -->
      <section class="hero" aria-labelledby="hero-title">
        <span class="kicker">MiHora Lampa · Recepción</span>
        <h1 id="hero-title">Cambiar estado</h1>
        <p class="sub">Actualiza el estado de la cita seleccionada.</p>
      </section>

      <!-- FORMULARIO -->
      <section class="card" style="margin-top:20px;">
        <form method="post" class="card shadow-sm">
          {% csrf_token %}
          <input type="hidden" name="next" value="{{ next }}">
          <div class="card-body">
            <div class="mb-3">
              <label class="form-label">Nuevo estado</label>
              {{ form.estado }}
              {% if form.errors.estado %}
                <div class="text-danger small">{{ form.errors.estado }}</div>
              {% endif %}
            </div>

            {% if form.non_field_errors %}
              <div class="alert alert-danger">{{ form.non_field_errors }}</div>
            {% endif %}
          </div>
          <div class="card-footer d-flex justify-content-end gap-2">
            <a href="{{ next|default:request.META.HTTP_REFERER|default:'#' }}" class="btn btn-outline-secondary">Volver</a>
            <button class="btn btn-primary" type="submit">Guardar</button>
          </div>
        </form>
      </section>
    </div>
  </body>
</html>
