{% load static %}
<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Restablecer contraseña · MiHora Lampa</title>
  <link rel="stylesheet" href="{% static 'core/css/paciente.css' %}">
  <link rel="icon" type="image/png" href="{% static 'core/img/logo_lampa.png' %}">
</head>

<body class="login-page">
  <div class="login-wrap">

    <!-- Logo -->
    <div class="login-logo">
      <img src="{% static 'core/img/logo_lampa.png' %}" alt="MiHora Lampa">
    </div>

    <!-- Card -->
    <div class="login-card">
      <h1 class="login-title">Restablecer contraseña</h1>
      <p class="login-subtitle">Ingresa y confirma tu nueva contraseña para actualizar tu acceso.</p>

      <!-- Mensajes de Django -->
      {% if messages %}
        {% for m in messages %}
          <div class="login-alert {% if m.tags %}{{ m.tags }}{% endif %}">{{ m }}</div>
        {% endfor %}
      {% endif %}

      <!-- Errores no asociados a campo -->
      {% if form.non_field_errors %}
        <div class="login-alert error">{{ form.non_field_errors }}</div>
      {% endif %}

      <!-- Formulario -->
      <form method="post" novalidate>
        {% csrf_token %}

        <!-- Nueva contraseña -->
        <div class="login-field">
          <label class="login-label" for="{{ form.nueva_password.id_for_label }}">
            {{ form.nueva_password.label|default:"Nueva contraseña" }}
          </label>
          <div class="login-control">
            {{ form.nueva_password }}
          </div>
          {% if form.nueva_password.errors %}
            <ul class="errorlist">
              {% for e in form.nueva_password.errors %}<li>{{ e }}</li>{% endfor %}
            </ul>
          {% else %}
            <p class="login-help">Mínimo 8 caracteres. Usa mayúsculas, minúsculas y números.</p>
          {% endif %}
        </div>

        <!-- Confirmar contraseña -->
        <div class="login-field">
          <label class="login-label" for="{{ form.confirmar_password.id_for_label }}">
            {{ form.confirmar_password.label|default:"Confirmar contraseña" }}
          </label>
          <div class="login-control">
            {{ form.confirmar_password }}
          </div>
          {% if form.confirmar_password.errors %}
            <ul class="errorlist">
              {% for e in form.confirmar_password.errors %}<li>{{ e }}</li>{% endfor %}
            </ul>
          {% endif %}
        </div>

        <button type="submit" class="login-btn">Guardar nueva contraseña</button>
      </form>

      <p class="login-links">
        <a href="{% url 'login_paciente' %}">Volver al ingreso</a>
      </p>
    </div>
  </div>

  <!-- JS ligero para mostrar/ocultar contraseña y mejorar usabilidad -->
  <script>
    (function () {
      // Asignar placeholders y atributos si no vienen desde forms.py
      var pw1 = document.getElementById('{{ form.nueva_password.id_for_label }}');
      var pw2 = document.getElementById('{{ form.confirmar_password.id_for_label }}');
      [pw1, pw2].forEach(function (el, i) {
        if (!el) return;
        if (!el.hasAttribute('placeholder')) {
          el.setAttribute('placeholder', i === 0 ? 'Nueva contraseña' : 'Repite la contraseña');
        }
        el.setAttribute('autocomplete', 'new-password');
      });

      // Botones Mostrar/Ocultar
      document.querySelectorAll('.login-toggle').forEach(function (btn) {
        btn.addEventListener('click', function () {
          var which = btn.getAttribute('data-toggle');
          var input = which === 'pw1' ? pw1 : pw2;
          if (!input) return;
          var isPass = input.type === 'password';
          input.type = isPass ? 'text' : 'password';
          btn.textContent = isPass ? 'Ocultar' : 'Mostrar';
        });
      });
    })();
  </script>
</body>

</html>
